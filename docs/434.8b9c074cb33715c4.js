"use strict";(self.webpackChunktask_controller_angular=self.webpackChunktask_controller_angular||[]).push([[434],{1434:(K,h,o)=>{o.r(h),o.d(h,{UserModule:()=>z});var p=o(6895),v=o(860),x=o(8098),b=o(8896),i=o(433),t=o(8274),Z=o(1135),c=o(4004),f=o(262),m=o(2843),u=o(8505),A=o(8746),U=o(3568),g=o(2340),T=o(529);let O=(()=>{class e{constructor(r){this.http=r}getCurrentUser(){return this.http.get(g.N.apiUrl+"/users/current").pipe((0,c.U)(s=>s.user))}updatePassword(r){return this.http.patch(g.N.apiUrl+"/users/password",r).pipe((0,u.b)(a=>a))}updateAvatar(r){let s=new FormData;return s.append("avatar",r),this.http.patch(g.N.apiUrl+"/users/avatars",s).pipe((0,c.U)(l=>l.user.avatarURL))}}return e.\u0275fac=function(r){return new(r||e)(t.LFG(T.eN))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var P=o(9430),C=o(5134);let I=(()=>{class e{constructor(r,s,a){this.user=r,this.messages=s,this.loader=a,this.defaultUser={email:"",avatarURL:"",createdAt:""},this.subject=new Z.X(this.defaultUser),this.currentUser$=this.subject.asObservable(),this.loadCurrentUser()}loadCurrentUser(){const r=this.user.getCurrentUser().pipe((0,c.U)(s=>s),(0,f.K)(s=>{const a="Could not load user data";return this.messages.showErrors(a),console.log(a,s),(0,m._)(s)}),(0,u.b)(s=>this.subject.next(s)));this.loader.showLoaderUntilCompleted(r).subscribe()}updateAvatar(r){const s=this.subject.getValue();let a=this.defaultUser;return this.user.updateAvatar(r).pipe((0,f.K)(l=>{const d="Could not update avatar";return this.messages.showErrors(d),console.log(d,l),(0,m._)(l)}),(0,u.b)(l=>a={...s,avatarURL:l}),(0,A.x)(()=>this.subject.next(a)),(0,U.d)())}updatePassword(r){return this.user.updatePassword(r).pipe((0,f.K)(s=>{const a="Could not change password";return this.messages.showErrors(a),console.log(a,s),(0,m._)(s)}),(0,u.b)(s=>{this.messages.showSuccess(s.message)}),(0,U.d)())}}return e.\u0275fac=function(r){return new(r||e)(t.LFG(O),t.LFG(P.K),t.LFG(C.b))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var J=o(7458);function L(e,n){if(1&e&&t._UZ(0,"img",15),2&e){const r=t.oxw();t.Q6J("src",r.user.avatarURL,t.LSH)}}function M(e,n){1&e&&t._UZ(0,"img",16)}function y(e,n){1&e&&(t.TgZ(0,"small"),t._uU(1,"Password length must be at least 8 characters"),t.qZA())}function Y(e,n){if(1&e&&(t.TgZ(0,"div",17),t.YNc(1,y,2,0,"small",18),t.qZA()),2&e){const r=t.oxw();t.xp6(1),t.Q6J("ngIf",r.form.controls.password)}}function S(e,n){1&e&&(t.TgZ(0,"small"),t._uU(1,"Password length must be at least 8 characters"),t.qZA())}function N(e,n){if(1&e&&(t.TgZ(0,"div",17),t.YNc(1,S,2,0,"small",18),t.qZA()),2&e){const r=t.oxw();t.xp6(1),t.Q6J("ngIf",r.form.controls.confirmPassword)}}function F(e,n){1&e&&(t.TgZ(0,"small",17),t._uU(1,"Both password must be equal"),t.qZA())}const w=function(e){return{invalid:e}};let j=(()=>{class e{constructor(r,s,a,l,d){this.fb=r,this.store=s,this.messages=a,this.loader=l,this.auth=d,this.submitted=!1,this.error=!1,this.avatarFile=null}ngOnInit(){this.loadUserData()}loadUserData(){this.store.currentUser$.subscribe(r=>this.user=r),this.form=this.fb.group({password:[null,[i.kI.required,i.kI.minLength(8)]],confirmPassword:[null,[i.kI.required,i.kI.minLength(8)]]})}changePassword(){const r=this.form.value;if(r.password!=r.confirmPassword)return this.error=!0;this.submitted=!0,this.store.updatePassword({password:r.password}).subscribe(()=>{this.submitted=!1,this.form.reset()},()=>this.submitted=!1)}addAvatar(r){this.loader.loadingOn(),this.avatarFile=r.target.files[0];const s=localStorage.getItem("user");let a;const d={...this.auth.subject.getValue(),avatarURL:this.user.avatarURL};if(this.avatarFile)return this.store.updateAvatar(this.avatarFile).subscribe(()=>{this.auth.subject.next(d),localStorage.setItem("user",JSON.stringify(d)),s&&(a={...JSON.parse(s),avatarURL:this.user.avatarURL}),this.loader.loadingOff()})}}return e.\u0275fac=function(r){return new(r||e)(t.Y36(i.qu),t.Y36(I),t.Y36(P.K),t.Y36(C.b),t.Y36(J.C))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-profile"]],decls:27,vars:18,consts:[[1,"profile"],[1,"profile-container"],["alt","avatar",3,"src",4,"ngIf"],["alt","avatar","src","./assets/images/avatarka.png",4,"ngIf"],[1,"btn"],["for","files"],["id","files","name","avatar","type","file",2,"display","none",3,"change"],[1,"profile__info"],[1,"profile__password"],[1,"form",3,"formGroup"],[3,"ngClass"],["formControlName","password","type","password","placeholder","Password",1,"form__input"],["class","validation",4,"ngIf"],["formControlName","confirmPassword","type","password","placeholder","Confirm password",1,"form__input"],[1,"btn",3,"disabled","click"],["alt","avatar",3,"src"],["alt","avatar","src","./assets/images/avatarka.png"],[1,"validation"],[4,"ngIf"]],template:function(r,s){1&r&&(t.TgZ(0,"div",0)(1,"div",1),t.YNc(2,L,1,1,"img",2),t.YNc(3,M,1,0,"img",3),t.TgZ(4,"div",4)(5,"label",5),t._uU(6,"Select image"),t.qZA(),t.TgZ(7,"input",6),t.NdJ("change",function(l){return s.addAvatar(l)}),t.qZA()(),t.TgZ(8,"div",7)(9,"h3"),t._uU(10),t.qZA(),t.TgZ(11,"p"),t._uU(12),t.ALo(13,"date"),t.qZA(),t.TgZ(14,"p",8),t._uU(15,"\u0421hange password:"),t.qZA(),t.TgZ(16,"form",9)(17,"div",10),t._UZ(18,"input",11),t.YNc(19,Y,2,1,"div",12),t.qZA(),t.TgZ(20,"div",10),t._UZ(21,"input",13),t.YNc(22,N,2,1,"div",12),t.qZA(),t.TgZ(23,"div")(24,"button",14),t.NdJ("click",function(){return s.changePassword()}),t._uU(25," Save "),t.qZA()()(),t.YNc(26,F,2,0,"small",12),t.qZA()()()),2&r&&(t.xp6(2),t.Q6J("ngIf",s.user.avatarURL),t.xp6(1),t.Q6J("ngIf",!s.user.avatarURL),t.xp6(7),t.hij("Email: ",s.user.email,""),t.xp6(2),t.hij("Registration date: ",t.xi3(13,11,s.user.createdAt,"dd.MM.YYYY"),""),t.xp6(4),t.Q6J("formGroup",s.form),t.xp6(1),t.Q6J("ngClass",t.VKq(14,w,s.form.controls.password.touched&&s.form.controls.password.invalid)),t.xp6(2),t.Q6J("ngIf",s.form.controls.password.touched&&s.form.controls.password.invalid),t.xp6(1),t.Q6J("ngClass",t.VKq(16,w,s.form.controls.confirmPassword.touched&&s.form.controls.confirmPassword.invalid)),t.xp6(2),t.Q6J("ngIf",s.form.controls.confirmPassword.touched&&s.form.controls.confirmPassword.invalid),t.xp6(2),t.Q6J("disabled",!s.form.valid||s.submitted),t.xp6(2),t.Q6J("ngIf",s.error))},dependencies:[p.mk,p.O5,i._Y,i.Fj,i.JJ,i.JL,i.sg,i.u,p.uU],styles:[".profile[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:50px;font-size:16px}.profile-container[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:column;padding:20px;background-color:#20b2ab1a;width:50%;border-radius:60px;box-shadow:5px 10px 15px #676c7899}.profile-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%;margin-bottom:20px;width:250px;height:250px;box-shadow:5px 10px 15px #676c7899}.profile__info[_ngcontent-%COMP%]{text-align-last:left;padding:10px}.profile__info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:10px}.profile__password[_ngcontent-%COMP%]{margin-top:10px}.btn[_ngcontent-%COMP%]{margin-top:10px;margin-bottom:10px;font-size:16px;padding:10px 20px;text-align:center;background-color:#fff;border-radius:20px;cursor:pointer;box-shadow:5px 5px 10px #676c7866;transition:all .5s ease-out}.btn[_ngcontent-%COMP%]:hover{box-shadow:5px 5px 10px #676c7899}.form__input[_ngcontent-%COMP%]{border-radius:40px;border:1px solid lightseagreen;padding:10px 20px;width:75%;margin:10px 20px 0 0;box-shadow:0 10px 20px #676c7866;outline:none;font-size:16px}.form__input[_ngcontent-%COMP%]:focus{outline:2px solid lightseagreen}.validation[_ngcontent-%COMP%]{color:red;text-align:left}.form[_ngcontent-%COMP%]{margin-top:10px;display:flex;text-align:center}"]}),e})();var Q=o(4466);const R=[{path:"",component:j,canActivate:[x.a]}];let z=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({providers:[x.a,b.e],imports:[p.ez,v.Bz.forChild(R),i.UX,i.u5,Q.m,v.Bz]}),e})()}}]);